{% extends "base.html" %}

{% block title %}Roast Batches{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="bi bi-box-seam"></i> Roast Batches</h1>
    {% if current_user.is_roaster() %}
    <a href="{{ url_for('roast.new_batch') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> New Batch
    </a>
    {% endif %}
</div>

{% if batches.items %}
<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Batch ID</th>
                <th>Date</th>
                <th>Profile</th>
                <th>Weight (kg)</th>
                <th>Loss %</th>
                <th>Roast Level</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for batch in batches.items %}
            <tr>
                <td><strong>{{ batch.batch_id }}</strong></td>
                <td>{{ batch.roast_date.strftime('%Y-%m-%d') if batch.roast_date else 'N/A' }}</td>
                <td>{{ batch.profile.name if batch.profile else 'N/A' }}</td>
                <td>{{ batch.green_weight }} â†’ {{ batch.roasted_weight }}</td>
                <td>{{ "%.2f"|format(batch.weight_loss_pct) if batch.weight_loss_pct else 'N/A' }}%</td>
                <td><span class="badge roast-{{ batch.roast_level }}">{{ batch.roast_level or 'N/A' }}</span></td>
                <td>
                    <a href="{{ url_for('roast.batch_detail', id=batch.id) }}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Pagination -->
{% if batches.has_prev or batches.has_next %}
<nav>
    <ul class="pagination justify-content-center">
        {% if batches.has_prev %}
        <li class="page-item"><a class="page-link" href="{{ url_for('roast.batches', page=batches.prev_num) }}">Previous</a></li>
        {% endif %}
        {% if batches.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('roast.batches', page=batches.next_num) }}">Next</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="alert alert-info">No batches yet. {% if current_user.is_roaster() %}<a href="{{ url_for('roast.new_batch') }}">Create your first batch</a>{% endif %}</div>
{% endif %}
{% endblock %}
